{"version":3,"file":"VaFileUpload.vue_vue_type_script_setup_true_lang.js","sources":["../../../../../src/components/va-file-upload/VaFileUpload.vue"],"sourcesContent":["<template>\n  <div\n    class=\"va-file-upload\"\n    :class=\"computedClasses\"\n    :style=\"computedStyle\"\n  >\n    <slot>\n      <div class=\"va-file-upload__field\">\n        <div\n          v-if=\"dropzone\"\n          class=\"va-file-upload__field__text\"\n        >\n          {{ tp(dropZoneText) }}\n        </div>\n        <va-button\n          class=\"va-file-upload__field__button\"\n          :disabled=\"disabled\"\n          :aria-disabled=\"disabled\"\n          :color=\"colorComputed\"\n          :style=\"{ 'pointer-events': dropzoneHighlight ? 'none' : undefined }\"\n          @change=\"changeFieldValue\"\n          @click=\"callFileDialogue\"\n        >\n          {{ tp(uploadButtonText) }}\n        </va-button>\n      </div>\n    </slot>\n\n    <input\n      ref=\"fileInputRef\"\n      type=\"file\"\n      class=\"va-file-upload__field__input\"\n      :tabindex=\"-1\"\n      aria-hidden=\"true\"\n      :accept=\"fileTypes\"\n      :multiple=\"type !== 'single'\"\n      :disabled=\"disabled\"\n      @change=\"changeFieldValue\"\n      @dragenter=\"dropzoneHighlight = true\"\n      @dragleave=\"dropzoneHighlight = false\"\n    >\n    <va-file-upload-list\n      v-if=\"files.length && !$props.hideFileList\"\n      v-bind=\"fileUploadListProps\"\n      :type=\"type\"\n      :files=\"files\"\n      :color=\"colorComputed\"\n      @remove=\"removeFile\"\n      @removeSingle=\"removeSingleFile\"\n    />\n    <va-modal\n      v-model=\"modal\"\n      hide-default-actions\n      title=\"File validation\"\n      message=\"File type is incorrect!\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, onMounted, ref, toRef, shallowRef, provide, PropType, ComputedRef } from 'vue'\n\nimport { useColors, useComponentPresetProp, useBem, useTranslation, useNumericProp } from '../../composables'\n\nimport { VaFileUploadKey, VaFile } from './types'\n\nimport { VaButton, VaModal } from '../index'\nimport { VaFileUploadList } from './VaFileUploadList'\nimport { extractComponentProps, filterComponentProps } from '../../utils/component-options'\n\nconst VaFileUploadListProps = extractComponentProps(VaFileUploadList)\n</script>\n\n<script lang=\"ts\" setup>\n\ndefineOptions({\n  name: 'VaFileUpload',\n})\n\nconst props = defineProps({\n  ...useComponentPresetProp,\n  ...VaFileUploadListProps,\n  fileTypes: { type: String, default: '' },\n  dropzone: { type: Boolean, default: false },\n  hideFileList: { type: Boolean, default: false },\n  color: { type: String, default: 'primary' },\n  disabled: { type: Boolean, default: false },\n  undo: { type: Boolean, default: false },\n  undoDuration: { type: [Number, String], default: 3000 },\n  undoButtonText: { type: String, default: '$t:undo' },\n  dropZoneText: { type: String, default: '$t:dropzone' },\n  uploadButtonText: { type: String, default: '$t:uploadFile' },\n  deletedFileMessage: { type: String, default: '$t:fileDeleted' },\n  modelValue: {\n    type: [Object, Array] as PropType<VaFile | VaFile[]>,\n    default: () => [],\n  },\n  type: {\n    type: String as PropType<'list' | 'gallery' | 'single'>,\n    default: 'list',\n    validator: (value: string) => ['list', 'gallery', 'single'].includes(value),\n  },\n})\n\nconst emit = defineEmits(['update:modelValue', 'file-removed', 'file-added'])\n\nconst fileInputRef = shallowRef<HTMLInputElement>()\n\nconst modal = ref(false)\nconst dropzoneHighlight = ref(false)\n\nconst { getColor, shiftHSLAColor } = useColors()\nconst colorComputed = computed(() => getColor(props.color))\n\nconst computedStyle = computed(() => ({\n  backgroundColor: props.dropzone\n    ? shiftHSLAColor(colorComputed.value, { a: dropzoneHighlight.value ? -0.82 : -0.92 })\n    : 'transparent',\n}))\n\nconst computedClasses = useBem('va-file-upload', () => ({\n  dropzone: props.dropzone,\n  disabled: props.disabled,\n}))\n\nconst files = computed<VaFile[]>({\n  get () { return Array.isArray(props.modelValue) ? props.modelValue : [props.modelValue] },\n  set (files) {\n    if (props.type === 'single') {\n      emit('update:modelValue', files[0])\n    } else {\n      emit('update:modelValue', files)\n    }\n  },\n})\n\nconst filterInvalidFiles = (files: VaFile[]) => files.filter((file) => {\n  const fileName = file.name || file.url\n  if (!fileName) { return false }\n  if (file.url) { return true }\n\n  const MIMETypes = ['audio/*', 'video/*', 'image/*']\n  const isContainedMIMEType = MIMETypes.find((t) => props.fileTypes.includes(t))\n\n  if (isContainedMIMEType) {\n    // Do not validate MIMEType because there is too much to validate.\n    return true\n  }\n\n  const extension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase()\n\n  const isCorrectExt = props.fileTypes.includes(extension)\n  if (!isCorrectExt) { modal.value = true }\n\n  return isCorrectExt\n})\n\nconst uploadFile = (e: Event | DragEvent) => {\n  const f = (e.target as HTMLInputElement)?.files || (e as DragEvent).dataTransfer?.files\n\n  if (!f) { return }\n\n  const validatedFiles = props.fileTypes ? filterInvalidFiles(Array.from(f)) : f\n\n  files.value = props.type === 'single' ? (validatedFiles as VaFile[]) : [...files.value, ...validatedFiles]\n\n  emit('file-added', validatedFiles)\n}\n\nconst changeFieldValue = (e: Event | DragEvent) => {\n  uploadFile(e)\n\n  if (fileInputRef.value) {\n    fileInputRef.value.value = ''\n  }\n}\n\nconst removeFile = (index: number) => {\n  if (index in files.value) {\n    const removedFile = files.value[index]\n    files.value = files.value.filter((item, idx) => idx !== index)\n    emit('file-removed', removedFile)\n  }\n}\n\nconst removeSingleFile = () => {\n  if (files.value.length > 0) {\n    const removedFile = files.value[0]\n    files.value = []\n    emit('file-removed', removedFile)\n  }\n}\n\nconst callFileDialogue = () => {\n  if (fileInputRef.value) {\n    fileInputRef.value.click()\n  }\n}\n\nonMounted(() => {\n  if (Array.isArray(files.value)) {\n    const filteredFiles = filterInvalidFiles(files.value)\n    if (filteredFiles.length !== files.value.length) {\n      files.value = filteredFiles\n    }\n  }\n})\n\nconst { tp } = useTranslation()\n\nprovide(VaFileUploadKey, {\n  undo: toRef(props, 'undo'),\n  disabled: toRef(props, 'disabled'),\n  undoDuration: useNumericProp('undoDuration') as ComputedRef<number>,\n  undoButtonText: computed(() => tp(props.undoButtonText)),\n  deletedFileMessage: computed(() => tp(props.deletedFileMessage)),\n})\n\nconst fileUploadListProps = filterComponentProps(VaFileUploadListProps)\n</script>\n\n<style lang='scss'>\n@import \"../../styles/resources\";\n@import \"variables\";\n\n.va-file-upload {\n  position: var(--va-file-upload-position);\n  font-family: var(--va-font-family);\n  margin: var(--va-file-upload-margin);\n\n  .va-file-upload-list {\n    margin-top: var(--va-file-upload-list-margin-top);\n  }\n\n  &__field {\n    overflow: hidden;\n    display: flex;\n    align-items: center;\n    position: relative;\n\n    &__button {\n      margin: var(--va-file-upload-dropzone-field-button-margin);\n      z-index: 10;\n    }\n\n    &__text {\n      padding-right: var(--va-file-upload-dropzone-field-text-pr);\n    }\n\n    &__input {\n      position: absolute;\n      top: 0;\n      right: 0;\n      height: 100%;\n      width: 100%;\n      color: transparent;\n      opacity: 0;\n      cursor: pointer;\n\n      &::-webkit-file-upload-button {\n        cursor: pointer;\n      }\n    }\n  }\n\n  &--dropzone {\n    background-color: var(--va-file-upload-dropzone-background-color);\n    overflow: hidden;\n    border-radius: var(--va-file-upload-dropzone-border-radius);\n    cursor: var(--va-file-upload-dropzone-cursor);\n\n    .va-file-upload__field {\n      justify-content: center;\n      display: flex;\n      align-items: center;\n      padding: var(--va-file-upload-dropzone-field-padding);\n      transition: height 0.2s;\n      overflow: visible;\n      flex-wrap: wrap;\n\n      @include media-breakpoint-down(sm) {\n        flex-direction: column;\n        padding: var(--va-file-upload-dropzone-field-padding-sm);\n\n        &__text {\n          padding: var(--va-file-upload-dropzone-text-padding-sm);\n          text-align: center;\n        }\n      }\n    }\n\n    .va-file-upload-list {\n      padding: var(--va-file-upload-dropzone-list-padding);\n      margin-top: 0;\n    }\n  }\n\n  &--disabled {\n    .va-file-upload__field__input {\n      cursor: default;\n\n      &::-webkit-file-upload-button {\n        cursor: inherit;\n      }\n    }\n  }\n\n  .va-button {\n    @include keyboard-focus-outline($offset: -2px);\n  }\n}\n</style>\n"],"names":["files"],"mappings":"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"}