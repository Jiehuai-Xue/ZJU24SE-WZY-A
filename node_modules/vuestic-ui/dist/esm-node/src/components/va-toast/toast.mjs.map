{"version":3,"file":"toast.mjs","sources":["../../../../../src/components/va-toast/toast.ts"],"sourcesContent":["import { VNode, createVNode, render, AppContext } from 'vue'\n\nimport { getGlobal } from '../../utils/ssr'\nimport type { ToastOptions } from './types'\n\nimport _VaToast from './VaToast.vue'\nimport { withConfigTransport } from '../../services/config-transport'\n\nexport const VaToast = withConfigTransport(_VaToast)\n\nconst GAP = 5\nlet seed = 1\n\ndeclare global {\n  interface Window {\n    vaToastInstances: VNode[]\n  }\n}\n\ngetGlobal().vaToastInstances = []\n\ntype OptionKeys = keyof ToastOptions;\n\nexport type VaToastId = string\n\nconst getTranslateValue = (item: VNode, position: string) => {\n  if (item.el) {\n    const direction = position.includes('bottom') ? -1 : 1\n    return (item.el.offsetHeight + GAP) * direction\n  }\n  return 0\n}\n\nconst getNewTranslateValue = (transformY: string, redundantHeight: number, position: string) => {\n  const direction = position.includes('bottom') ? -1 : 1\n  return parseInt(transformY, 10) - (redundantHeight + GAP) * direction\n}\n\nconst getNodeProps = (vNode: VNode): Record<OptionKeys, any> => {\n  return (vNode.component?.props as Record<OptionKeys, any>) || {}\n}\n\nconst closeNotification = (targetInstance: VNode | null, destroyElementFn: () => void) => {\n  if (!targetInstance) { return }\n\n  if (!getGlobal().vaToastInstances.length) {\n    seed = 1\n    return\n  }\n\n  const targetInstanceIndex = getGlobal().vaToastInstances.findIndex((instance) => instance === targetInstance)\n\n  if (targetInstanceIndex < 0) { return }\n\n  const nodeProps = getNodeProps(targetInstance)\n\n  const {\n    offsetX: targetOffsetX,\n    offsetY: targetOffsetY,\n    position: targetPosition,\n  } = nodeProps\n  const redundantHeight: number | null = targetInstance.el?.offsetHeight\n\n  destroyElementFn()\n\n  getGlobal().vaToastInstances = getGlobal().vaToastInstances.reduce((acc: any[], instance, index) => {\n    if (instance === targetInstance) {\n      return acc\n    }\n    if (instance.component) {\n      const { offsetX, offsetY, position } = getNodeProps(instance)\n      const isNextInstance = index > targetInstanceIndex && targetOffsetX === offsetX && targetOffsetY === offsetY && targetPosition === position\n      if (isNextInstance && instance.el && redundantHeight) {\n        const [_, transformY] = instance.el.style.transform.match(/[\\d-]+(?=px)/g)\n        const transformYNew = getNewTranslateValue(transformY, redundantHeight, position)\n        instance.el.style.transform = `translate(0, ${transformYNew}px)`\n      }\n    }\n    return [...acc, instance]\n  }, [])\n\n  if (!getGlobal().vaToastInstances.length) {\n    seed = 1\n  }\n}\n\nconst destroy = (el: HTMLElement | null | undefined, node: VNode | null) => {\n  if (el) {\n    render(null, el)\n    el.remove()\n  }\n  el = null\n  node = null\n}\n\nconst mount = (component: any, {\n  props,\n  children,\n  element,\n  appContext,\n}: { props?: { [key: string]: any }; children?: any; element?: HTMLElement; appContext?: AppContext } = {}): { vNode: VNode; el?: HTMLElement } => {\n  let el: HTMLElement | null | undefined = element\n\n  // eslint-disable-next-line prefer-const\n  let vNode: VNode | null\n\n  const onClose = () => {\n    closeNotification(vNode, () => destroy(el, vNode))\n\n    if (props?.onClose) {\n      props.onClose()\n    }\n  }\n\n  vNode = createVNode(component, { ...props, onClose }, children)\n\n  if (appContext) {\n    vNode.appContext = appContext\n  }\n\n  if (el) {\n    render(vNode, el)\n  } else if (typeof document !== 'undefined') {\n    render(vNode, el = document.createElement('div'))\n  }\n\n  return { vNode, el }\n}\n\nexport const closeAllNotifications = (appContext?: AppContext) => {\n  if (!getGlobal().vaToastInstances.length) {\n    seed = 1\n    return\n  }\n  getGlobal().vaToastInstances.forEach(instance => {\n    if (appContext && instance.appContext !== appContext) { return }\n    getNodeProps(instance).onClose()\n  })\n}\n\nexport const closeById = (id: string) => {\n  const targetInstance = getGlobal().vaToastInstances.find(instance => instance.el?.id === id)\n\n  if (targetInstance) {\n    const nodeProps = getNodeProps(targetInstance)\n    nodeProps.onClose()\n  }\n}\n\nconst getToastOptions = (options: string | ToastOptions): any => {\n  if (typeof options === 'string') {\n    return {\n      message: options,\n    }\n  }\n  return options\n}\n\nexport const createToastInstance = (customProps: ToastOptions | string, appContext?: AppContext): VaToastId | null => {\n  const { vNode, el } = mount(VaToast, { appContext, props: getToastOptions(customProps) })\n\n  const nodeProps = getNodeProps(vNode)\n\n  if (el && vNode.el && nodeProps) {\n    document.body.appendChild(el.childNodes[0])\n    const { offsetX, offsetY, position } = nodeProps\n\n    vNode.el.style.display = 'flex'\n    vNode.el.id = 'notification_' + seed\n\n    let transformY = 0\n    getGlobal().vaToastInstances.filter(item => {\n      const {\n        offsetX: itemOffsetX,\n        offsetY: itemOffsetY,\n        position: itemPosition,\n      } = getNodeProps(item)\n\n      return itemOffsetX === offsetX && itemOffsetY === offsetY && position === itemPosition\n    }).forEach((item) => {\n      transformY += getTranslateValue(item, position)\n    })\n    vNode.el.style.transform = `translate(0, ${transformY}px)`\n\n    seed += 1\n\n    getGlobal().vaToastInstances.push(vNode)\n\n    return vNode.el.id as VaToastId\n  }\n\n  return null\n}\n\nexport type { ToastOptions as NotificationOptions } from './types'\n"],"names":["_VaToast"],"mappings":"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"}