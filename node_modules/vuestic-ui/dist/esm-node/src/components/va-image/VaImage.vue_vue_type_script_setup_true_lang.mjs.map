{"version":3,"file":"VaImage.vue_vue_type_script_setup_true_lang.mjs","sources":["../../../../../src/components/va-image/VaImage.vue"],"sourcesContent":["<template>\n  <va-aspect-ratio\n    ref=\"root\"\n    class=\"va-image\"\n    v-bind=\"aspectRationAttributesComputed\"\n   :style=\"`--va-fit-computed: ${String(fitComputed)}`\">\n    <picture\n      v-show=\"isSuccessfullyLoaded\"\n      class=\"va-image__content\"\n      :aria-busy=\"isLoading\"\n    >\n      <slot v-if=\"$slots.sources\" name=\"sources\" />\n\n      <img\n        v-if=\"isReadyForRender\"\n        ref=\"image\"\n        v-bind=\"imgAttributesComputed\"\n        @error=\"handleError\"\n        @load=\"handleLoad\"\n      />\n    </picture>\n\n    <div\n      v-if=\"$slots.default && isSuccessfullyLoaded\"\n      class=\"va-image__overlay\"\n    >\n      <slot />\n    </div>\n\n    <div\n      v-if=\"isError && ($slots.error || isAnyFallbackPassed)\"\n      class=\"va-image__error\"\n    >\n      <slot name=\"error\">\n        <va-fallback v-bind=\"fallbackProps\" @fallback=\"$emit('fallback')\" />\n      </slot>\n    </div>\n\n    <div\n      v-if=\"isLoading && $slots.loader\"\n      class=\"va-image__loader\"\n    >\n      <slot name=\"loader\" />\n    </div>\n\n    <div\n      v-if=\"isPlaceholderShown\"\n      class=\"va-image__placeholder\"\n    >\n      <slot name=\"placeholder\">\n        <img\n          v-if=\"$props.placeholderSrc\"\n          :src=\"$props.placeholderSrc\"\n          alt=\"\"\n        />\n      </slot>\n    </div>\n  </va-aspect-ratio>\n</template>\n\n<script lang=\"ts\">\nimport {\n  ref,\n  computed,\n  watch,\n  nextTick,\n  onBeforeMount,\n  onBeforeUnmount,\n  type PropType,\n  useSlots,\n} from 'vue'\nimport pick from 'lodash/pick.js'\n\nimport { VaAspectRatio } from '../va-aspect-ratio'\nimport { VaFallback } from '../va-fallback'\n\nimport { useNativeImgAttributes, useNativeImgAttributesProps } from './hooks/useNativeImgAttributes'\nimport {\n  useComponentPresetProp,\n  useIsMounted,\n  useIntersectionObserver,\n  useGlobalConfig,\n} from '../../composables'\n\nimport { extractComponentProps, filterComponentProps } from '../../utils/component-options'\n\nconst VaFallbackProps = extractComponentProps(VaFallback)\n</script>\n\n<script lang=\"ts\" setup>\n\ndefineOptions({\n  name: 'VaImage',\n})\n\nconst props = defineProps({\n  ...useComponentPresetProp,\n  ...useNativeImgAttributesProps,\n  ...VaFallbackProps,\n  ratio: {\n    type: [Number, String] as PropType<number | 'auto'>,\n    default: 'auto',\n    validator: (v: number | 'auto') => {\n      if (typeof v === 'number') {\n        return v > 0\n      }\n\n      return v === 'auto'\n    },\n  },\n  fit: {\n    type: String as PropType<'contain' | 'fill' | 'cover' | 'scale-down' | 'none'>,\n    default: 'cover',\n  },\n  maxWidth: {\n    type: [Number, String],\n    default: 0,\n    validator: (v: number | string) => Number(v) >= 0,\n  },\n  lazy: { type: Boolean, default: false },\n  placeholderSrc: { type: String, default: '' },\n})\n\nconst emit = defineEmits(['loaded', 'error', 'fallback'])\n\nconst root = ref<HTMLElement>()\nconst image = ref<HTMLImageElement>()\n\nconst renderedImage = ref()\nconst currentImage = computed(() => renderedImage.value || props.src)\n\nconst imgWidth = ref(1)\nconst imgHeight = ref(1)\n\nconst isLoading = ref(false)\nconst isError = ref(false)\n\nconst handleLoad = () => {\n  isLoading.value = true\n\n  if (!isReadyForLoad.value) { return }\n\n  isLoading.value = false\n\n  renderedImage.value = image.value?.currentSrc\n  getImgSizes()\n\n  emit('loaded', currentImage.value)\n}\n\nconst handleError = (err?: Event) => {\n  isError.value = true\n  isLoading.value = false\n\n  emit('error', err || currentImage.value)\n}\n\nconst isIntersecting = ref(false)\nconst handleIntersection = (entries: IntersectionObserverEntry[], observer: IntersectionObserver) => {\n  entries.forEach((entry) => {\n    if (!entry.isIntersecting) { return }\n\n    isIntersecting.value = true\n    init()\n    observer.disconnect()\n  })\n}\nconst { isIntersectionDisabled } = useIntersectionObserver(handleIntersection, undefined, root, props.lazy)\nconst isReadyForLoad = computed(() => isIntersectionDisabled.value || isIntersecting.value)\nconst isMounted = useIsMounted()\nconst isReadyForRender = computed(() => !props.lazy || (props.lazy && isMounted.value && isReadyForLoad.value))\n\nconst init = () => {\n  if (!props.src || (isLoading.value && isIntersectionDisabled.value) || !isReadyForLoad.value) {\n    return\n  }\n\n  isLoading.value = true\n  isError.value = false\n\n  nextTick(() => {\n    if (!image.value?.complete) {\n      return\n    }\n\n    if (!image.value.naturalWidth) {\n      handleError()\n      return\n    }\n\n    handleLoad()\n  })\n}\n\nlet timer: ReturnType<Window['setTimeout']>\nconst getImgSizes = () => {\n  clearTimeout(timer)\n\n  if (isLoading.value) {\n    timer = window.setTimeout(getImgSizes, 100)\n  }\n\n  const { naturalHeight, naturalWidth } = image.value || {}\n  if (naturalHeight && naturalWidth) {\n    imgWidth.value = naturalHeight\n    imgHeight.value = naturalWidth\n  }\n}\n\nonBeforeMount(init)\nonBeforeUnmount(() => clearTimeout(timer))\nwatch(() => props.src, init)\n\nconst slots = useSlots()\nconst isPlaceholderPassed = computed(() => slots?.placeholder?.() || props.placeholderSrc)\nconst isLoaderShown = computed(() => isLoading.value && !slots?.loader?.())\nconst isErrorShown = computed(() => isError.value && (!slots?.error?.() && !isAnyFallbackPassed.value))\nconst isPlaceholderShown = computed(() => (isLoaderShown.value || isErrorShown.value) && isPlaceholderPassed.value)\n\nconst isSuccessfullyLoaded = computed(() => !(isLoading.value || isError.value))\n\nconst imgAttributesComputed = useNativeImgAttributes(props)\n\nconst aspectRationAttributesComputed = computed(() => ({\n  ...pick(props, ['ratio', 'maxWidth']),\n  contentWidth: imgWidth.value,\n  contentHeight: imgHeight.value,\n}))\n\nconst fallbackProps = filterComponentProps(VaFallbackProps)\nconst checkObjectNonEmptyValues = (obj: Record<string, any> | undefined) => !!Object.values(obj || {}).filter((prop) => prop).length\nconst hasFallbackGlobalConfig = computed(() => checkObjectNonEmptyValues(useGlobalConfig()?.globalConfig?.value?.components?.VaFallback))\nconst isAnyFallbackPassed = computed(() => checkObjectNonEmptyValues(fallbackProps.value) || hasFallbackGlobalConfig.value)\n\nconst fitComputed = computed(() => props.fit)\n</script>\n\n<style lang=\"scss\">\n@import 'variables';\n\n.va-image {\n  &__content {\n    position: var(--va-image-content-position);\n    inset: 0;\n    width: 100%;\n\n    img {\n      width: 100%;\n      height: 100%;\n      object-fit: var(--va-fit-computed);\n      object-position: var(--va-image-content-img-object-position);\n    }\n  }\n\n  &__overlay {\n    position: absolute;\n    inset: 0;\n  }\n\n  &__placeholder,\n  &__loader,\n  &__error,\n  &__overlay {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n</style>\n"],"names":[],"mappings":"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"}